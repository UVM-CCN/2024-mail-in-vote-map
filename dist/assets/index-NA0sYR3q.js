(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const l of e.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function r(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(t){if(t.ep)return;t.ep=!0;const e=r(t);fetch(t.href,e)}})();const n=660,d=700,i=d3.select("#map").append("svg").attr("width",n).attr("height",d),u=d3.geoMercator().center([-72.7,44]).scale(1e4).translate([n/3,d/2]),E=d3.geoPath().projection(u),p=d3.scaleLinear().range(["white","#164734"]);var h=i.append("defs"),c=h.append("linearGradient").attr("id","linear-gradient").attr("transform","translate(100, 20)");c.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");c.append("stop").attr("offset","0%").attr("stop-color","white");c.append("stop").attr("offset","100%").attr("stop-color","#164734");i.append("rect").attr("width",300).attr("height",20).attr("transform",`translate(${n/3-100}, 20)`).style("fill","url(#linear-gradient)").attr("stroke","black");i.append("text").attr("x",n/3-100).attr("y",60).text("0").attr("fill","black");i.append("text").attr("x",n/3+180).attr("y",60).text("100%").attr("fill","black");const f={RECEIVED:0,REQUESTED:0,ISSUED:0};Promise.all([d3.json("public/data/FS_VCGI_OPENDATA_Boundary_BNDHASH_poly_towns_SP_v1_-4796836414587772833.geojson"),d3.csv("public/data/DetailedAbsenteeVotersList_9.30.2024.csv")]).then(function([a,o]){const r=y(o);console.log(r);const s=Object.values(r).map(t=>t.RECEIVED);p.domain([0,d3.max(s)]),a.features.forEach(t=>{console.log(t.properties.TOWNNAME);const e=t.properties.TOWNNAME.toUpperCase();t.properties.votes=r[e]||{RECEIVED:0,REQUESTED:0,ISSUED:0}}),i.selectAll("path").data(a.features).enter().append("path").attr("d",E).attr("class","county").attr("fill",t=>p(t.properties.votes.RECEIVED)).on("mouseover",function(t,e){d3.select(this).attr("stroke","#333").attr("stroke-width",4),g(t,e)}).on("mouseout",function(){d3.select(this).attr("stroke","#fff").attr("stroke-width",.5),m()}),console.log(f)});function y(a){const o={};return a.forEach(r=>{f[r["Ballot Status"]]++;const s=r["Town Name"],t=r["Ballot Status"];o[s]||(o[s]={RECEIVED:0,REQUESTED:0,ISSUED:0}),o[s][t]++}),o}function g(a,o){const r=d3.select("#tooltip"),s=o.properties.votes.RECEIVED,t=o.properties.votes.ISSUED,e=Math.round(s/t*100);console.log(o.properties),r.style("opacity",1).html(`<b>${o.properties.votes.RECEIVED} votes</b> received from <b>${o.properties.TOWNNAME}</b><br><br>${e}% of all ballots`).style("left",a.pageX+10+"px").style("top",a.pageY-28+"px")}function m(){d3.select("#tooltip").style("opacity",0)}
