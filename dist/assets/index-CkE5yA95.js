(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))e(E);new MutationObserver(E=>{for(const o of E)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function s(E){const o={};return E.integrity&&(o.integrity=E.integrity),E.referrerPolicy&&(o.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?o.credentials="include":E.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(E){if(E.ep)return;E.ep=!0;const o=s(E);fetch(E.href,o)}})();const c=660;d3.select("#loader").style("display","block");const n=d3.select("#map").append("svg").attr("width","100%").attr("height","100%").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 660 700");function T(){const r=d3.select("#map").node().getBoundingClientRect();let t=r.width,s=r.height,e,E,o=15;console.log(r.width),r.width>700?(t=700,s=800,E=s/2.3,e=200):r.width>500&&r.width<700?(t=r.width,s=800,e=200,E=s/2.2,o=16):(t=r.width,s=700,e=t/1.7,E=s/1.5,o=35),n.attr("width",t).attr("height",s),N.scale(Math.min(t,s)*o).translate([e,E]),d=d3.geoPath().projection(N),n.selectAll("path").attr("d",d),n.select("rect").attr("width",t*.55).attr("transform",`translate(${t/4-t*.225}, 20)`),n.selectAll("text").attr("x",(i,u)=>u===0?t/4-t*.225:t/4+t*.225)}const N=d3.geoMercator().center([-72.7,44]).scale(1e4),d=d3.geoPath().projection(N),l=d3.scaleLinear().range(["white","#164734"]);var C=n.append("defs"),f=C.append("linearGradient").attr("id","linear-gradient").attr("transform","translate(50, 20)");f.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");f.append("stop").attr("offset","0%").attr("stop-color","white");f.append("stop").attr("offset","100%").attr("stop-color","#164734");n.append("rect").attr("width",300).attr("height",20).attr("transform",`translate(${c/3.5-100}, 20)`).style("fill","url(#linear-gradient)").attr("stroke","black");const a={RECEIVED:0,REQUESTED:0,ISSUED:0,PERCENTAGE:0,DEFECTIVE:0,UNDELIVERABLE:0,"UNKNOWN-NEVER RETURNED":0,"RECEIVED / CURED BALLOT":0,"RECEIVED AFTER ELECTION":0};let p=0,R=[];Promise.all([d3.json("https://raw.githubusercontent.com/UVM-CCN/2024-mail-in-vote-map/refs/heads/main/external-data/FS_VCGI_OPENDATA_Boundary_BNDHASH_poly_towns_SP_v1_-4796836414587772833.geojson"),d3.csv("https://raw.githubusercontent.com/UVM-CCN/2024-mail-in-vote-map/refs/heads/main/external-data/filtered-20241014.csv")]).then(function([r,t]){d3.select("#loader").style("display","none");const s=D(t);Object.values(s).map(e=>e.RECEIVED),l.domain([0,p]),r.features.forEach(e=>{e.properties.TOWNNAME=="AVERILL"&&console.log(e);let E=e.properties.TOWNNAME.toUpperCase();e.properties.votes=s[E]||{RECEIVED:0,REQUESTED:0,ISSUED:0}}),n.selectAll("path").data(r.features).enter().append("path").attr("d",d).attr("class","county").attr("fill",e=>t.find(E=>E["Town Name"]==e.properties.TOWNNAME)||e.properties.TOWNNAME=="ESSEX"||e.properties.TOWNNAME=="ESSEX JUNCTION"?l(e.properties.votes.PERCENTAGE):l(0)).on("mouseover",function(e,E){d3.select(this).attr("stroke","#333").attr("stroke-width",4),h(e,E)}).on("mouseout",function(){d3.select(this).attr("stroke","#fff").attr("stroke-width",.5),I()}),n.append("text").attr("x",c/3.5-105).attr("y",60).text("0%").attr("fill","black"),n.append("text").attr("x",c/3.5+180).attr("y",60).text(Math.round(p)+"%").attr("fill","black")});function D(r){const t={};R=[...new Set(r.map(e=>e["Ballot Status"]))],console.log(R),r.forEach(e=>{let E=e["Town Name"];const o=e["Ballot Status"];e["Town Name"]=="ESSEX TOWN"?E="ESSEX":e["Town Name"]=="ESSEX JUNCTION CITY"&&(E="ESSEX JUNCTION"),t[E]||(t[E]={RECEIVED:0,REQUESTED:0,ISSUED:0,DEFECTIVE:0,UNDELIVERABLE:0,"UNKNOWN-NEVER RETURNED":0,"RECEIVED / CURED BALLOT":0,"RECEIVED AFTER ELECTION":0,PERCENTAGE:0}),a[e["Ballot Status"]]++,t[E][o]++}),console.log(a);for(const e in t){e=="SOUTH HERO"&&console.log(t[e]),t[e].DEFECTIVE||(t[e].DEFECTIVE=0),t[e].UNDELIVERABLE==null&&(t[e].UNDELIVERABLE=0),t[e]["UNKNOWN-NEVER RETURNED"]||(t[e]["UNKNOWN-NEVER RETURNED"]=0),t[e]["RECEIVED / CURED BALLOT"]||(t[e]["RECEIVED / CURED BALLOT"]=0),t[e]["RECEIVED AFTER ELECTION"]||(t[e]["RECEIVED AFTER ELECTION"]=0);const E=t[e].RECEIVED+t[e]["RECEIVED / CURED BALLOT"]+t[e]["RECEIVED AFTER ELECTION"],o=t[e].ISSUED+t[e].UNDELIVERABLE+t[e]["UNKNOWN-NEVER RETURNED"]+t[e].DEFECTIVE;(E==0||o==0)&&(t[e].PERCENTAGE=0),t[e].PERCENTAGE=E/(o+E)*100}for(const e in t)t[e].PERCENTAGE>p&&(p=t[e].PERCENTAGE);return console.log("max percentage",p),a.PERCENTAGE=(a.RECEIVED+a["RECEIVED / CURED BALLOT"])/(a.ISSUED+a.RECEIVED+a["RECEIVED / CURED BALLOT"]+a.DEFECTIVE+a.UNDELIVERABLE+a["UNKNOWN-NEVER RETURNED"]+a.REQUESTED)*100,a.PERCENTAGE=a.PERCENTAGE.toFixed(2),d3.select("#subtitle").text(`In total, ${a.PERCENTAGE}% of mail-in ballots have been returned and tallied as of Oct 14, 2024`),t}function h(r,t){const s=d3.select("#tooltip"),e=t.properties.votes.RECEIVED+t.properties.votes["RECEIVED / CURED BALLOT"]+t.properties.votes["RECEIVED AFTER ELECTION"],E=t.properties.votes.ISSUED+t.properties.votes.UNDELIVERABLE+t.properties.votes["UNKNOWN-NEVER RETURNED"]+t.properties.votes.DEFECTIVE,o=Math.round(e/(E+e)*100);console.log(t.properties);let i;o?i=`<span style='font-size: 21px'><b>${o}%</b> of <b>${t.properties.TOWNNAME}</b> mail-in ballots tallied</span><br><br>${e} ballots received out of ${E+e} sent out`:(console.log(t.properties),t.properties.votes.ISSUED>0?i=`<span style='font-size: 21px'><b>${o}%</b> of <b>${t.properties.TOWNNAME}</b> mail-in ballots tallied</span><br><br>${e} ballots received out of ${E+e} sent out`:i=`<b>${t.properties.TOWNNAME}</b> <br><br> No data available`),s.style("opacity",1).html(i).style("left",r.pageX+10+"px").style("top",r.pageY-28+"px")}function I(){d3.select("#tooltip").style("opacity",0)}T();window.addEventListener("resize",T);
