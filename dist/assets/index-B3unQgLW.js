(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();const p=660,f=700;d3.select("#loader").style("display","block");const l=d3.select("#map").append("svg").attr("width",p).attr("height",f),u=d3.geoMercator().center([-72.7,44]).scale(1e4).translate([p/3,f/2]),h=d3.geoPath().projection(u),E=d3.scaleLinear().range(["white","#164734"]);var m=l.append("defs"),d=m.append("linearGradient").attr("id","linear-gradient").attr("transform","translate(100, 20)");d.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");d.append("stop").attr("offset","0%").attr("stop-color","white");d.append("stop").attr("offset","100%").attr("stop-color","#164734");l.append("rect").attr("width",300).attr("height",20).attr("transform",`translate(${p/3-100}, 20)`).style("fill","url(#linear-gradient)").attr("stroke","black");const s={RECEIVED:0,REQUESTED:0,ISSUED:0,PERCENTAGE:0};let c=0;Promise.all([d3.json("https://raw.githubusercontent.com/UVM-CCN/2024-mail-in-vote-map/refs/heads/main/external-data/FS_VCGI_OPENDATA_Boundary_BNDHASH_poly_towns_SP_v1_-4796836414587772833.geojson"),d3.csv("https://raw.githubusercontent.com/UVM-CCN/2024-mail-in-vote-map/refs/heads/main/external-data/filtered-20241007.csv")]).then(function([a,o]){d3.select("#loader").style("display","none");const n=N(o);Object.values(n).map(e=>e.RECEIVED),E.domain([0,c]),a.features.forEach(e=>{e.properties.TOWNNAME=="AVERILL"&&console.log(e);const t=e.properties.TOWNNAME.toUpperCase();e.properties.votes=n[t]||{RECEIVED:0,REQUESTED:0,ISSUED:0}}),l.selectAll("path").data(a.features).enter().append("path").attr("d",h).attr("class","county").attr("fill",e=>o.find(t=>t["Town Name"]==e.properties.TOWNNAME)?(console.log("no"),E(e.properties.votes.PERCENTAGE)):E(0)).on("mouseover",function(e,t){d3.select(this).attr("stroke","#333").attr("stroke-width",4),S(e,t)}).on("mouseout",function(){d3.select(this).attr("stroke","#fff").attr("stroke-width",.5),y()}),console.log(s),l.append("text").attr("x",p/3-100).attr("y",60).text("0").attr("fill","black"),l.append("text").attr("x",p/3+180).attr("y",60).text(Math.round(c)+"%").attr("fill","black")});function N(a){const o={};a.forEach(e=>{s[e["Ballot Status"]]++;let t=e["Town Name"];const r=e["Ballot Status"];e["Town Name"]=="ESSEX TOWN"?t="ESSEX":e["Town Name"]=="ESSEX JUNCTION CITY"&&(t="ESSEX JUNCTION"),t=="LEWIS"&&console.log("averill",e),o[t]||(o[t]={RECEIVED:0,REQUESTED:0,ISSUED:0}),o[t][r]++});for(const e in o){const t=o[e].RECEIVED,r=o[e].ISSUED;(t==0||r==0)&&(o[e].PERCENTAGE=0),o[e].PERCENTAGE=t/r*100}for(const e in o)o[e].PERCENTAGE>c&&(c=o[e].PERCENTAGE);return console.log("max percentage",c),s.PERCENTAGE=s.RECEIVED/s.ISSUED*100,console.log(s),s.PERCENTAGE=s.PERCENTAGE.toFixed(2),d3.select("#subtitle").text(`In total, ${s.PERCENTAGE}% of Vermonters have returned their ballots as of Oct 7, 2024`),o}function S(a,o){const n=d3.select("#tooltip"),e=o.properties.votes.RECEIVED,t=o.properties.votes.ISSUED,r=Math.round(e/t*100);let i;r?i=`<b>${o.properties.votes.RECEIVED} votes</b> received from <b>${o.properties.TOWNNAME}</b><br><br>${r}% of all ballots sent to this town out of ${o.properties.votes.ISSUED}`:i=`<b>${o.properties.TOWNNAME}</b> <br><br> No data available`,console.log(o.properties),n.style("opacity",1).html(i).style("left",a.pageX+10+"px").style("top",a.pageY-28+"px")}function y(){d3.select("#tooltip").style("opacity",0)}
