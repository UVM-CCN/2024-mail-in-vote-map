(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(e){if(e.ep)return;e.ep=!0;const r=a(e);fetch(e.href,r)}})();const d=660;d3.select("#loader").style("display","block");const i=d3.select("#map").append("svg").attr("width","100%").attr("height","100%").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 660 700");function h(){const s=d3.select("#map").node().getBoundingClientRect(),t=s.width,a=s.height;console.log(s),i.attr("width",t).attr("height",a),E.scale(Math.min(t,a)*14.3).translate([t/3,a/2.2]),f=d3.geoPath().projection(E),i.selectAll("path").attr("d",f),i.select("rect").attr("width",t*.45).attr("transform",`translate(${t/3-t*.225}, 20)`),i.selectAll("text").attr("x",(o,e)=>e===0?t/3-t*.225:t/3+t*.225)}const E=d3.geoMercator().center([-72.7,44]).scale(1e4),f=d3.geoPath().projection(E),p=d3.scaleLinear().range(["white","#164734"]);var m=i.append("defs"),u=m.append("linearGradient").attr("id","linear-gradient").attr("transform","translate(100, 20)");u.attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");u.append("stop").attr("offset","0%").attr("stop-color","white");u.append("stop").attr("offset","100%").attr("stop-color","#164734");i.append("rect").attr("width",300).attr("height",20).attr("transform",`translate(${d/3-100}, 20)`).style("fill","url(#linear-gradient)").attr("stroke","black");const n={RECEIVED:0,REQUESTED:0,ISSUED:0,PERCENTAGE:0};let c=0;Promise.all([d3.json("https://raw.githubusercontent.com/UVM-CCN/2024-mail-in-vote-map/refs/heads/main/external-data/FS_VCGI_OPENDATA_Boundary_BNDHASH_poly_towns_SP_v1_-4796836414587772833.geojson"),d3.csv("https://raw.githubusercontent.com/UVM-CCN/2024-mail-in-vote-map/refs/heads/main/external-data/filtered-20241010.csv")]).then(function([s,t]){d3.select("#loader").style("display","none");const a=g(t);Object.values(a).map(o=>o.RECEIVED),p.domain([0,c]),s.features.forEach(o=>{o.properties.TOWNNAME=="AVERILL"&&console.log(o);const e=o.properties.TOWNNAME.toUpperCase();o.properties.votes=a[e]||{RECEIVED:0,REQUESTED:0,ISSUED:0}}),i.selectAll("path").data(s.features).enter().append("path").attr("d",f).attr("class","county").attr("fill",o=>t.find(e=>e["Town Name"]==o.properties.TOWNNAME)?(console.log("no"),p(o.properties.votes.PERCENTAGE)):p(0)).on("mouseover",function(o,e){d3.select(this).attr("stroke","#333").attr("stroke-width",4),N(o,e)}).on("mouseout",function(){d3.select(this).attr("stroke","#fff").attr("stroke-width",.5),y()}),console.log(n),i.append("text").attr("x",d/3-105).attr("y",60).text("0%").attr("fill","black"),i.append("text").attr("x",d/3+180).attr("y",60).text(Math.round(c)+"%").attr("fill","black")});function g(s){const t={};s.forEach(o=>{n[o["Ballot Status"]]++;let e=o["Town Name"];const r=o["Ballot Status"];o["Town Name"]=="ESSEX TOWN"?e="ESSEX":o["Town Name"]=="ESSEX JUNCTION CITY"&&(e="ESSEX JUNCTION"),e=="LEWIS"&&console.log("averill",o),t[e]||(t[e]={RECEIVED:0,REQUESTED:0,ISSUED:0}),t[e][r]++});for(const o in t){const e=t[o].RECEIVED,r=t[o].ISSUED;(e==0||r==0)&&(t[o].PERCENTAGE=0),t[o].PERCENTAGE=e/r*100}for(const o in t)t[o].PERCENTAGE>c&&(c=t[o].PERCENTAGE);return console.log("max percentage",c),n.PERCENTAGE=n.RECEIVED/n.ISSUED*100,console.log(n),n.PERCENTAGE=n.PERCENTAGE.toFixed(2),d3.select("#subtitle").text(`In total, ${n.PERCENTAGE}% of Vermonters have returned their ballots as of Oct 10, 2024`),t}function N(s,t){const a=d3.select("#tooltip"),o=t.properties.votes.RECEIVED,e=t.properties.votes.ISSUED,r=Math.round(o/e*100);let l;r?l=`<span style='font-size: 21px'><b>${r}%</b> of <b>${t.properties.TOWNNAME}</b> has voted</span><br><br>${t.properties.votes.RECEIVED} ballots received out of ${t.properties.votes.ISSUED} sent out`:l=`<b>${t.properties.TOWNNAME}</b> <br><br> No data available`,console.log(t.properties),a.style("opacity",1).html(l).style("left",s.pageX+10+"px").style("top",s.pageY-28+"px")}function y(){d3.select("#tooltip").style("opacity",0)}h();window.addEventListener("resize",h);
